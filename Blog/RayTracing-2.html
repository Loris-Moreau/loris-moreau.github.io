<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>RayTracing 2</title>
    <link rel="icon" type="image/x-icon" href="../Images/Suprise.webp">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Loris Moreau">
    <meta name="description" content="Raytracing Blog">
    <meta name="keywords" content="Showcase, Loris, Moreau, Loris Moreau, Programmer, coding adventure, Blog, Post, Raytracing, C++, CPP, Raytracing in one weekend, ppm, render, ray">

    <!-- Styles -->
    <link rel="stylesheet" href="../Styles/style.css">
    <link rel="stylesheet" href="../Styles/Code-Quote.css">

    <!-- Carousel script (deferred) -->
    <script src="../Scripts/Carousel.js" defer></script>
</head>

<body>
<!-- Main of the post -->
<main id="BlogPost" class="post">
    <!-- Top showcase: carousel + short intro in a flex row -->
    <header>
        <!-- ========== Section 1 Navbar ========== -->
        <nav style="margin: 0 auto 2em auto;">
            <ul>
                <li><a href="../Blog.html">Back</a></li>
                <li><a href="../index.html" target="_blank">Main</a></li>
                <li><a href="../Blog.html" target="_blank">Blog</a></li>
                <li><a href="../Resources.html" target="_blank">Resources</a></li>
            </ul>
        </nav>
        
        <div class="flex-container">
            <img width="40%" loading="lazy" src="../Images/RayTracing/Final%20Render%20(B1).webp" alt="Final Result of book 1" />
            
            <!-- Intro / author column -->
            <div class="text-container">
                <h1>Raytracing in one weekend in C++</h1>
                <p>Welcome to my adventure following the <a href="https://raytracing.github.io/" target="_blank">Ray Tracing in One Weekend</a> series in C++.</p>
                <p>
                    <a target="_blank" href="https://github.com/Loris-Moreau/RayTracing" class="cta-button">GitHub Repository</a>
                </p>
            </div>
        </div>
    </header>

    <!-- Section 1: Part 2 / Overview -->
    <section>
        <div>
            <h2 class="underline" style="text-decoration-color: dodgerblue">Part 2</h2>

            <p>First we need an IDE (I'm using Rider) and we will write the image to a <code>.ppm</code> file — use a viewer like "Simple PPM Viewer" or open it in VS Code.</p>

            <h4><i class="underline" style="text-decoration-color: cadetblue">Little Side note :</i>
                The PPM file format (P3) stores the type, resolution and each pixel as three integers (0–255).
            </h4>
            
            <p>Now obviously we will need to start a new project and first output a basic color to a .ppm file using a loop.</p>
        </div>
    </section>

    <!-- Code example: simple ppm writer -->
    <section>
        <h2 class="underline" style="text-decoration-color: royalblue">Basic PPM output</h2>

        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Raytracing.cpp</p></div>
                <div class="Sconsole">
<pre><code>#include &lt;iostream&gt;

using namespace std;

int main(int argc, char* argv[])
{
   // Resolution
   int width = 256, height = 256;
   // Image
   cout &lt;&lt; "P3\n" &lt;&lt; width &lt;&lt; ' ' &lt;&lt; height &lt;&lt; "\n255\n";
   for(int y = 0; y &lt; height; y++)
   {
       for (int x = 0; x &lt; width; x++)
       {
           double w = double(x) / (width - 1);   // % of width
           double h = double(y) / (height - 1);  // % of height

           int r = static_cast&lt;int&gt;(255.999 * w);
           int g = static_cast&lt;int&gt;(255.999 * h);
           int b = 255 - r;

           cout &lt;&lt; r &lt;&lt; ' ' &lt;&lt; g &lt;&lt; ' ' &lt;&lt; b &lt;&lt; '\n';
       }
   }

   return 0;
}</code></pre>
                </div>
            </div>
        </div>

        <h3>To produce a file, run:</h3>
        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Terminal</p></div>
                <div class="Sconsole">
                    <pre><code>.\x64\Debug\RayTracing.exe &gt; Render.ppm</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Utilities: Vector, Color, etc. -->
    <section>
        <h2 class="underline" style="text-decoration-color: royalblue">Utilities</h2>

        <h3>First: a simple Vector3</h3>
        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Vector3.h</p></div>
                <div class="Sconsole">
<pre><code>#pragma once
#include &lt;cmath&gt;

class Vector3
{
public:
   double x, y, z;

   Vector3(): x(0), y(0), z(0){}
   Vector3(double pX, double pY, double pZ) : x(pX), y(pY), z(pZ){}

   Vector3 operator-() const { return Vector3(-x, -y, -z); }
   double operator[](int i) const { return i == 0 ? x : (i == 1 ? y : z); }
   double& operator[](int i) { return i == 0 ? x : (i == 1 ? y : z); }

   Vector3& operator+=(const Vector3& rVec) { x+= rVec.x; y += rVec.y; z += rVec.z; return *this; }
   Vector3& operator*=(double t) { x*= t; y *= t; z *= t; return *this; }
   Vector3& operator/=(double t) { x/= t; y /= t; z /= t; return *this; }

   double Length() const { return sqrt(SquaredLength()); }
   double SquaredLength() const { return x*x + y*y + z*z; }
};</code></pre>
                </div>
            </div>
        </div>

        <h3>Then add operators (after the class)</h3>
        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Vector3.h</p></div>
                <div class="Sconsole">
<pre><code>// Alias for Vector3
using Position = Vector3;

inline std::ostream& operator&lt;&lt;(std::ostream &rOut, const Vector3& rV)
{
   return rOut &lt;&lt; rV.x &lt;&lt; ' ' &lt;&lt; rV.y &lt;&lt; ' ' &lt;&lt; rV.z &lt;&lt; std::endl;
}

inline Vector3 operator+(const Vector3& a, const Vector3& b) { return Vector3(a.x+b.x, a.y+b.y, a.z+b.z); }
inline Vector3 operator-(const Vector3& a, const Vector3& b) { return Vector3(a.x-b.x, a.y-b.y, a.z-b.z); }
inline Vector3 operator*(const Vector3& a, const Vector3& b) { return Vector3(a.x*b.x, a.y*b.y, a.z*b.z); }
inline Vector3 operator*(const Vector3& v, double s) { return Vector3(v.x*s, v.y*s, v.z*s); }
inline Vector3 operator*(double s, const Vector3& v) { return v * s; }
inline Vector3 operator/(Vector3 v, double s) { return (1.0/s) * v; }</code></pre>
                </div>
            </div>
        </div>

        <h3>Color utility (alias)</h3>
        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Color.h</p></div>
                <div class="Sconsole">
<pre><code>#pragma once
#include "Vector3.h"

// Color is an alias for Vector3
using Color = Vector3;

inline void WriteColor(std::ostream &rOut, Color pixel)
{
   rOut &lt;&lt; static_cast&lt;int&gt;(255.999 * pixel.x) &lt;&lt; ' '
        &lt;&lt; static_cast&lt;int&gt;(255.999 * pixel.y) &lt;&lt; ' '
        &lt;&lt; static_cast&lt;int&gt;(255.999 * pixel.z) &lt;&lt; '\n';
}</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Rays, Camera, and Coloring -->
    <section>
        <h2 class="underline" style="text-decoration-color: royalblue">Rays, Camera & Coloring</h2>

        <h3>Ray class</h3>
        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Ray.h</p></div>
                <div class="Sconsole">
<pre><code>#pragma once
#include "Vector3.h"

class Ray
{
private:
   Position mOrigin;
   Vector3 mDirection;
public:
   Ray(){}
   Ray(const Position& from, const Vector3& towards) : mOrigin(from), mDirection(towards){}
   Position GetOrigin() const { return mOrigin; }
   Vector3 GetDirection() const { return mDirection; }
   Position At(double t) const { return mOrigin + t * mDirection; }
};</code></pre>
                </div>
            </div>
        </div>

        <h3>Viewport & pixel math</h3>
        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Raytracing.cpp</p></div>
                <div class="Sconsole">
<pre><code>// Viewport
double resolution = 16.0/9.0;
int width = 400, height = static_cast&lt;int&gt;(width / resolution);
if(height &lt; 1) height = 1;

double viewportHeight = 2;
double viewportWidth = viewportHeight * (static_cast&lt;double&gt;(width) / height);
double focalLength = 1;
Position cameraCenter = Position(0, 0, 0);

Vector3 viewportX = Vector3(viewportWidth, 0, 0);
Vector3 viewportY = Vector3(0, -viewportHeight, 0); // invert Y

Vector3 pixelDeltaX = viewportX / width;
Vector3 pixelDeltaY = viewportY / height;

Vector3 viewportOrigin = cameraCenter - Vector3(0, 0, focalLength) - viewportX/2 - viewportY/2;
Vector3 originPixelLocation = viewportOrigin + 0.5 * (pixelDeltaX + pixelDeltaY);</code></pre>
                </div>
            </div>
        </div>

        <h3>Simple RayColor (gradient)</h3>
        <div class="snippet">
            <div class="Swindow">
                <div class="Swindow-title"><p>Raytracing.cpp</p></div>
                <div class="Sconsole">
<pre><code>Color RayColor(const Ray& rRay)
{
   Vector3 unitDirection = Unit(rRay.GetDirection());
   double t = 0.5 * (unitDirection.y + 1.0);
   return (1.0 - t) * Color(1.0, 1.0, 1.0) + t * Color(0.5, 0.7, 1.0);
}</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Final notes -->
    <section>
        <h2 class="underline" style="text-decoration-color: cadetblue">There we go</h2>
        <p>Build the project, run it and open <code>Render.ppm</code> to see the result.</p>

        <p>Onward &amp; upwards - next post will add objects, intersections and shading.</p>
    </section>

    <footer>
        <p style="color: var(--text-color-bright);">16-01-2024</p>
    </footer>
</main>

<!-- Navigation buttons -->
<div style="text-align:center; margin-top:1rem">
    <a href="RayTracing-1.html" class="cta-button">Previous</a>
    <a href="../Blog.html" class="cta-button secondary" style="margin:0 0.75rem">Entries</a>
    <a href="RayTracing-3.html" class="cta-button">Next</a>
</div>

</body>
</html>
