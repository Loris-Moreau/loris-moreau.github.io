<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RayTracing 5</title>
    <link rel="icon" type="image/x-icon" href="../Images/Suprise.webp">
    <link rel="stylesheet" href="../Styles/MainStyle.css">
    
    <script src="../Scripts/CommonLayout.js" defer></script>
    
    <!-- Meta Tags for SEO -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Loris Moreau">
    <meta name="description" content="Raytracing Blog">
    <meta name="keywords" content="Showcase, Loris, Moreau, Loris Moreau, Programmer, coding adventure, Blog, Post, Raytracing, C++, CPP, Raytracing in one weekend, camera, thin lenses">
</head>

<body>

<!-- Back Button -->
<div class="backButton">
    <a href="../Blog.html">
        <button>
            Back
        </button>
    </a>
</div>


<!-- Blog Content -->
<div id="BlogPost" class="post">
    <h2 class="underline">Raytracing in one weekend in C++</h2>
    <h4><a href="https://github.com/Loris-Moreau/RayTracing" target="_blank">
    GitHub Repository
    </a></h4>
    <h3>Welcome to my adventure following the <a href="https://raytracing.github.io/" target="_blank">raytracing in one weekend</a> series in C++.</h3>

    <p style="padding: 5px"></p>

    <h2 class="underline" style="text-decoration-color: dodgerblue"> Part 5 </h2>
    
    <h2 class="underline" style="text-decoration-color: dodgerblue">Camera management</h2>
    <h3>Adjusting our point of view</h3>
    <!-- Code Snippet -->
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Camera.h</p>
            </div>
            <div class="Sconsole">
      <pre><code>#pragma once

#include "Color.h"
#include "Hittable.h"

class Camera
{
public:
   Camera() = default;
   Camera(double imageWidth, double ratio): aspectRatio(ratio), width(imageWidth){}
   void Render(const Hittable& rWorld);

private:
   int height;
   double aspectRatio, width;
   Position center, originPixelLocation;
   Vector3 pixelDeltaX, pixelDeltaY;
  
   void Initialize();
   Color RayColor(const Ray& rRay, const Hittable& rWorld) const;
};</code></pre>
            </div>
        </div>
    </div>
    <!-- Code Snippet -->
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Camera.cpp</p>
            </div>
            <div class="Sconsole">
      <pre><code>void Camera::Render(const Hittable& rWorld)
{
   Initialize();
   cout &lt&lt "P3\n" &lt&lt width &lt&lt ' ' &lt&lt height &lt&lt "\n255\n";
   for(int y = 0; y &lt height; y ++)
   {
       clog &lt&lt "Progress : " &lt&lt (y*100/height) &lt&lt " %\n" &lt&lt flush;
       for (int x = 0; x &lt width; x ++)
       {
           Position pixelCenter = originPixelLocation + (x * pixelDeltaX) + (y * pixelDeltaY);
           Vector3 direction = pixelCenter - center;
           Ray ray(center, direction);
           Color pixel = RayColor(ray, rWorld);
           WriteColor(cout, pixel);
       }
   }
   clog &lt&lt "Done! You can open your file now :) \n";
}

void Camera::Initialize()
{
   height = static_cast&ltint>(width / aspectRatio);
   if(height &lt 1) height = 1;
  
   center = Position(0, 0, 0);
   double focalLength = 1;
   double viewportHeight = 2;
   double viewportWidth = viewportHeight * (static_cast&ltdouble>(width)/height);

   Vector3 viewportX = Vector3(viewportWidth, 0, 0);
   Vector3 viewportY = Vector3(0, -viewportHeight, 0); // invert Y
  
   //Delta vector between pixels
   pixelDeltaX = viewportX / width;
   pixelDeltaY = viewportY / height;

   //Position of the top left pixel
   Vector3 viewportOrigin = center - Vector3(0, 0, focalLength) - viewportX / 2 - viewportY / 2;

   originPixelLocation = viewportOrigin + 0.5 * (pixelDeltaX + pixelDeltaY);

}

Color Camera::RayColor(const Ray& rRay, const Hittable& rWorld) const
{
   HitInfo hitInfo;
   if (rWorld.Hit(rRay, Interval(0, infinity), hitInfo)) {
       return 0.5 * (hitInfo.normal + Color(1,1,1));
   }
 
   Vector3 unitDirection = Unit(rRay.GetDirection());
   double blue = 0.5 * (unitDirection.y + 1.0);
   return (1.0 - blue) * Color(1.0, 1.0, 1.0) + blue * Color (0.5, 0.7, 1.0);
}
</code></pre>
            </div>
        </div>
    </div>
    
    <p style="padding: 2px"></p>
    
    <h3>now to clean up the main</h3>
    <!-- Code Snippet -->
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Raytracing.cpp</p>
            </div>
            <div class="Sconsole">
      <pre><code>#include "Camera.h"
#include "HittableCollection.h"
#include "Sphere.h"

using namespace std;

int main(int argc, char* argv[])
{
   // World
   HittableCollection world;
   world.Add(make_shared&ltSphere>(Position(0,0,-1), 0.5));
   world.Add(make_shared&ltSphere>(Position(0,-100.5,-1), 100));
  
   // Render
   Camera camera(400, 16.0/9.0);
   camera.Render(world);

   return 0;
}
</code></pre>
            </div>
        </div>
    </div>
    
    <p style="padding: 2px"></p>
    
    <h2 class="underline" style="text-decoration-color: dodgerblue; padding-bottom: 5px">Anti-aliasing</h2>
    <h5><i>the smooth stuff</i></h5>
    
    <p style="padding: 1px"></p>
    
    <h3 class="underline" style="text-decoration-color: darkorange"><i>Remember :</i></h3>
    <h3>- Coloring all faces traversed with the same color means it's aliased</h3>
    <h3>- Coloring faces traversed with an alpha depending on how much it goes through is unaliased</h3>
    <h4>Like so :</h4>
    <img loading="lazy" src="../Images/RayTracing/antialiasing.webp" alt="Anti Aliasing" style="width: 40%"/>

    <p style="padding: 2px"></p>
    
    <h2 class="underline" style="text-decoration-color: royalblue">Random Number</h2>
    
    <!-- Code Snippet -->
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Utility.h</p>
            </div>
            <div class="Sconsole">
      <pre><code>#pragma once

#include &ltcmath>
#include &ltlimits>
#include &ltmemory>
#include "Ray.h"
#include &ltcstdlib>

...

inline double RandomDouble()
{
   return rand() / (RAND_MAX + 1.0);
}

inline double RandomDouble(double min, double max)
{
   return min + (max - min) * RandomDouble();
}
</code></pre>
            </div>
        </div>
    </div>
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Interval.h</p>
            </div>
            <div class="Sconsole">
      <pre><code>double Clamp(double x) const
{
   return x < min ? min : x > max ? max : x;
}
</code></pre>
            </div>
        </div>
    </div>
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Color.h</p>
            </div>
            <div class="Sconsole">
      <pre><code>#include "Interval.h"

inline void WriteColor(std::ostream &out, Color pixel, int sampleCount)
{
   double scale = 1.0 / sampleCount;
   double r = pixel.x * scale;
   double g = pixel.y * scale;
   double b = pixel.z * scale;
  
   // Write the translated [0,255] value of each color component.
   static const Interval intensity(0.000, 0.999);
   out &lt&lt static_cast&ltint>(255.999 * intensity.Clamp(r)) &lt&lt ' '
       &lt&lt static_cast&ltint>(255.999 * intensity.Clamp(g)) &lt&lt ' '
       &lt&lt static_cast&ltint>(255.999 * intensity.Clamp(b)) &lt&lt '\n';
}
</code></pre>
            </div>
        </div>
    </div>

    <p style="padding: 1px"></p>
    
    <h3>Then for the camera</h3>
    <!-- Code Snippet -->
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Camera.h</p>
            </div>
            <div class="Sconsole">
      <pre><code>class Camera
{
public:
   Camera() = default;
   Camera(double imageWidth, double ratio, int samplePerPixel = 10): 
   aspectRatio(ratio), width(imageWidth), sampleCount(samplePerPixel){}

   void Render(const Hittable& rWorld);

private:
   int height;
   double aspectRatio, width;
   int sampleCount;
   Position center, originPixelLocation;
   Vector3 pixelDeltaX, pixelDeltaY;
  
   void Initialize();
   Color RayColor(const Ray& rRay, const Hittable& rWorld) const;
   Ray GetRay(int x, int y) const;
   Vector3 PixelSampleSquared() const;
};
</code></pre>
            </div>
        </div>
    </div>
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Camera.cpp</p>
            </div>
            <div class="Sconsole">
      <pre><code>void Camera::Render(const Hittable& rWorld)
{
   Initialize();
   cout &lt&lt "P3\n" &lt&lt width &lt&lt ' ' &lt&lt height &lt&lt "\n255\n";
   for(int y = 0; y &lt height; y ++)
   {
       clog &lt&lt "Progress : " &lt&lt (y*100/height) &lt&lt " %\n" &lt&lt flush;
       for (int x = 0; x &lt width; x ++)
       {
           Color pixel(0,0,0);
           for(int sample = 0; sample &lt sampleCount; sample ++)
           {
               Ray ray = GetRay(x, y);
               pixel += RayColor(ray, rWorld);
           }
          
           WriteColor(cout, pixel, sampleCount);
       }
   }
   clog &lt&lt "Done! You can open your file now :)\n";
}

Ray Camera::GetRay(int x, int y) const
{
   // Get a randomly sampled camera ray for the pixel at location i, j.

   Vector3 pixelCenter = originPixelLocation + (x * pixelDeltaX) + (y * pixelDeltaY);
   Vector3 pixelSample = pixelCenter + PixelSampleSquared();

   Position rayOrigin = center;
   Vector3 rayDirection = pixelSample - rayOrigin;

   return Ray(rayOrigin, rayDirection);
}

Vector3 Camera::PixelSampleSquared() const
{
   // Returns a random point in the square around a pixel at the origin
   double pX = -0.5 + RandomDouble();
   double pY = -0.5 + RandomDouble();
   return (pX * pixelDeltaX) + (pY * pixelDeltaY);
}
</code></pre>
            </div>
        </div>
    </div>

    <p style="padding: 2px"></p>
    
    <h3>Now to add the sampling count</h3>
    <!-- Code Snippet -->
    <div class="snippet">
        <div class="Swindow">
            <div class="Swindow-title">
                <p>Raytracing.cpp</p>
            </div>
            <div class="Sconsole">
      <pre><code>int main(int argc, char* argv[])
{
   // World
   HittableCollection world;
   world.Add(make_shared&ltSphere>(Position(0,0,-1), 0.5));
   world.Add(make_shared&ltSphere>(Position(0,-100.5,-1), 100));
   
   // Render
   Camera camera(400, 16.0/9.0, 100);
   camera.Render(world);
   return 0;
}
</code></pre>
            </div>
        </div>
    </div>

    <p style="padding: 0"></p>
    
    <h3>Now Render and see the beauty of a smoother image</h3>

    <p style="padding: 15px"></p>
    
    <h3>In the next we'll be adding colors</h3>
    
    <p style="padding: 0"></p>
    <h3>buh bye</h3>
    <p style="padding: 5px"></p>
</div>

<!-- Buttons -->
<div style="text-align: center; margin-top: 10px;">
    <!-- Previous Button, if none: href="../Blog.html" -->
    <a href="RayTracing-4.html">
        <button>
            Previous
        </button>
    </a>
    <!-- Back to blog -->
    <a href="../Blog.html">
        <button>
            Entries
        </button>
    </a>
    <!-- Next button, if none: go back to first post currently: href="Workflow.html"" -->
    <a href="RayTracing-6.html">
        <button>
            Next
        </button>
    </a>
    <p style="padding: 7px"></p>
</div>

<!-- Date -->
<h5>19-01-2024</h5>

</body>
</html>
